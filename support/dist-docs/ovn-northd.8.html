<html><head><meta charset="UTF-8"></head><body><pre>
ovn-northd(8)                 Open vSwitch Manual                ovn-northd(8)



<b>N</b><b>A</b><b>M</b><b>E</b>
       ovn-northd - Open Virtual Network central control daemon

<b>S</b><b>Y</b><b>N</b><b>O</b><b>P</b><b>S</b><b>I</b><b>S</b>
       <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> [<u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u><u>s</u>]

<b>D</b><b>E</b><b>S</b><b>C</b><b>R</b><b>I</b><b>P</b><b>T</b><b>I</b><b>O</b><b>N</b>
       <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>  is  a  centralized  daemon  responsible for translating the
       high-level OVN configuration into logical configuration  consumable  by
       daemons such as <b>o</b><b>v</b><b>n</b><b>-</b><b>c</b><b>o</b><b>n</b><b>t</b><b>r</b><b>o</b><b>l</b><b>l</b><b>e</b><b>r</b>.  It translates the logical network con‐
       figuration in terms of conventional network concepts,  taken  from  the
       OVN Northbound Database (see <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>b</b>(5)), into logical datapath flows in
       the OVN Southbound Database (see <b>o</b><b>v</b><b>n</b><b>-</b><b>s</b><b>b</b>(5)) below it.

<b>C</b><b>O</b><b>N</b><b>F</b><b>I</b><b>G</b><b>U</b><b>R</b><b>A</b><b>T</b><b>I</b><b>O</b><b>N</b>
       <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> requires a connection to the Northbound and Southbound data‐
       bases.   The  defaults are <b>o</b><b>v</b><b>n</b><b>n</b><b>b</b><b>_</b><b>d</b><b>b</b><b>.</b><b>s</b><b>o</b><b>c</b><b>k</b> and <b>o</b><b>v</b><b>n</b><b>s</b><b>b</b><b>_</b><b>d</b><b>b</b><b>.</b><b>s</b><b>o</b><b>c</b><b>k</b> respectively
       in the local Open vSwitch’s "run" directory.  This  may  be  overridden
       with the following commands:

              ·      <b>-</b><b>-</b><b>o</b><b>v</b><b>n</b><b>n</b><b>b</b><b>-</b><b>d</b><b>b</b><b>=</b><u>d</u><u>a</u><u>t</u><u>a</u><u>b</u><u>a</u><u>s</u><u>e</u>

                     The database containing the OVN Northbound Database.

              ·      <b>-</b><b>-</b><b>o</b><b>v</b><b>n</b><b>s</b><b>b</b><b>-</b><b>d</b><b>b</b><b>=</b><u>d</u><u>a</u><u>t</u><u>a</u><u>b</u><u>a</u><u>s</u><u>e</u>

                     The database containing the OVN Southbound Database.

       The <u>d</u><u>a</u><u>t</u><u>a</u><u>b</u><u>a</u><u>s</u><u>e</u> argument must take one of the following forms:

              ·      <b>s</b><b>s</b><b>l</b><b>:</b><u>i</u><u>p</u><b>:</b><u>p</u><u>o</u><u>r</u><u>t</u>

                     The specified SSL <u>p</u><u>o</u><u>r</u><u>t</u> on the host at the given <u>i</u><u>p</u>, which
                     must be expressed as an IP address (not a  DNS  name)  in
                     IPv4  or  IPv6 address format.  If <u>i</u><u>p</u> is an IPv6 address,
                     then wrap <u>i</u><u>p</u> with square brackets, e.g.:  <b>s</b><b>s</b><b>l</b><b>:</b><b>[</b><b>:</b><b>:</b><b>1</b><b>]</b><b>:</b><b>6</b><b>6</b><b>4</b><b>0</b>.
                     The  <b>-</b><b>-</b><b>p</b><b>r</b><b>i</b><b>v</b><b>a</b><b>t</b><b>e</b><b>-</b><b>k</b><b>e</b><b>y</b>,  <b>-</b><b>-</b><b>c</b><b>e</b><b>r</b><b>t</b><b>i</b><b>f</b><b>i</b><b>c</b><b>a</b><b>t</b><b>e</b>, and <b>-</b><b>-</b><b>c</b><b>a</b><b>-</b><b>c</b><b>e</b><b>r</b><b>t</b> options
                     are mandatory when this form is used.

              ·      <b>t</b><b>c</b><b>p</b><b>:</b><u>i</u><u>p</u><b>:</b><u>p</u><u>o</u><u>r</u><u>t</u>

                     Connect to the given TCP <u>p</u><u>o</u><u>r</u><u>t</u> on <u>i</u><u>p</u>, where <u>i</u><u>p</u> can be IPv4
                     or  IPv6  address. If <u>i</u><u>p</u> is an IPv6 address, then wrap <u>i</u><u>p</u>
                     with square brackets, e.g.: <b>t</b><b>c</b><b>p</b><b>:</b><b>[</b><b>:</b><b>:</b><b>1</b><b>]</b><b>:</b><b>6</b><b>6</b><b>4</b><b>0</b>.

              ·      <b>u</b><b>n</b><b>i</b><b>x</b><b>:</b><u>f</u><u>i</u><u>l</u><u>e</u>

                     On POSIX, connect to the Unix domain server socket  named
                     <u>f</u><u>i</u><u>l</u><u>e</u>.

                     On  Windows,  connect to a localhost TCP port whose value
                     is written in <u>f</u><u>i</u><u>l</u><u>e</u>.

<b>R</b><b>U</b><b>N</b><b>T</b><b>I</b><b>M</b><b>E</b> <b>M</b><b>A</b><b>N</b><b>A</b><b>G</b><b>E</b><b>M</b><b>E</b><b>N</b><b>T</b> <b>C</b><b>O</b><b>M</b><b>M</b><b>A</b><b>N</b><b>D</b><b>S</b>
       <b>o</b><b>v</b><b>s</b><b>-</b><b>a</b><b>p</b><b>p</b><b>c</b><b>t</b><b>l</b> can send commands to a running <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> process.  The cur‐
       rently supported commands are described below.

              <b>e</b><b>x</b><b>i</b><b>t</b>   Causes <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> to gracefully terminate.

<b>L</b><b>O</b><b>G</b><b>I</b><b>C</b><b>A</b><b>L</b> <b>F</b><b>L</b><b>O</b><b>W</b> <b>T</b><b>A</b><b>B</b><b>L</b><b>E</b> <b>S</b><b>T</b><b>R</b><b>U</b><b>C</b><b>T</b><b>U</b><b>R</b><b>E</b>
       One  of the main purposes of <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> is to populate the <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>F</b><b>l</b><b>o</b><b>w</b>
       table in the  <b>O</b><b>V</b><b>N</b><b>_</b><b>S</b><b>o</b><b>u</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database.   This  section  describes  how
       <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> does this for switch and router logical datapaths.

   <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b> <b>S</b><b>w</b><b>i</b><b>t</b><b>c</b><b>h</b> <b>D</b><b>a</b><b>t</b><b>a</b><b>p</b><b>a</b><b>t</b><b>h</b><b>s</b>
     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>0</u><u>:</u> <u>A</u><u>d</u><u>m</u><u>i</u><u>s</u><u>s</u><u>i</u><u>o</u><u>n</u> <u>C</u><u>o</u><u>n</u><u>t</u><u>r</u><u>o</u><u>l</u> <u>a</u><u>n</u><u>d</u> <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>L</u><u>2</u>

       Ingress table 0 contains these logical flows:

              ·      Priority 100 flows to drop packets with VLAN tags or mul‐
                     ticast Ethernet source addresses.

              ·      Priority 50 flows that implement  ingress  port  security
                     for  each  enabled  logical  port.   For logical ports on
                     which port security is enabled, these  match  the  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>
                     and  the valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> address(es) and advance only those
                     packets to the next flow table.   For  logical  ports  on
                     which  port  security  is  not enabled, these advance all
                     packets that match the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>.

       There are no flows for disabled logical ports because the  default-drop
       behavior  of  logical flow tables causes packets that ingress from them
       to be dropped.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>:</u> <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>I</u><u>P</u>

       Ingress table 1 contains these logical flows:

              ·      For each element in the port security set having  one  or
                     more IPv4 or IPv6 addresses (or both),

                     ·      Priority  90  flow to allow IPv4 traffic if it has
                            IPv4  addresses  which  match  the  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>,  valid
                            <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> and valid <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> address(es).

                     ·      Priority  90  flow  to  allow  IPv4 DHCP discovery
                            traffic if it has a valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>. This is  neces‐
                            sary  since  DHCP discovery messages are sent from
                            the unspecified IPv4 address (0.0.0.0)  since  the
                            IPv4 address has not yet been assigned.

                     ·      Priority  90  flow to allow IPv6 traffic if it has
                            IPv6  addresses  which  match  the  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>,  valid
                            <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> and valid <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> address(es).

                     ·      Priority  90  flow  to  allow  IPv6 DAD (Duplicate
                            Address Detection)  traffic  if  it  has  a  valid
                            <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>.  This  is  is necessary since DAD include
                            requires joining an multicast  group  and  sending
                            neighbor  solicitations  for  the  newly  assigned
                            address. Since no address is yet  assigned,  these
                            are sent from the unspecified IPv6 address (::).

                     ·      Priority  80  flow to drop IP (both IPv4 and IPv6)
                            traffic which match the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> and valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>:</u> <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>N</u><u>e</u><u>i</u><u>g</u><u>h</u><u>b</u><u>o</u><u>r</u> <u>d</u><u>i</u><u>s</u><u>c</u><u>o</u><u>v</u><u>e</u><u>r</u><u>y</u>

       Ingress table 2 contains these logical flows:

              ·      For each element in the port security set,

                     ·      Priority  90 flow to allow ARP traffic which match
                            the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> and valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> and <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b>.  If  the
                            element  has  one  or more IPv4 addresses, then it
                            also matches the valid <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b>.

                     ·      Priority 90 flow to allow IPv6 Neighbor  Solicita‐
                            tion  and  Advertisement  traffic  which match the
                            <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>, valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> and <b>n</b><b>d</b><b>.</b><b>s</b><b>l</b><b>l</b>/<b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b>.   If  the
                            element  has  one  or more IPv6 addresses, then it
                            also matches the valid <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b>  address(es)  for
                            Neighbor Advertisement traffic.

                     ·      Priority  80  flow  to  drop ARP and IPv6 Neighbor
                            Solicitation and Advertisement traffic which match
                            the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> and valid <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>3</u><u>:</u> <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> Pre-ACLs

       This table prepares flows  for  possible  stateful  ACL  processing  in
       ingress  table  <b>A</b><b>C</b><b>L</b><b>s</b>.   It contains a priority-0 flow that simply moves
       traffic to the next table.  If stateful ACLs are used  in  the  logical
       datapath, a priority-100 flow is added that sets a hint (with <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>]</b> <b>=</b>
       <b>1</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>) for table <b>P</b><b>r</b><b>e</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b> to send IP packets to  the  connection
       tracker before eventually advancing to ingress table <b>A</b><b>C</b><b>L</b><b>s</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>4</u><u>:</u> <u>P</u><u>r</u><u>e</u><u>-</u><u>L</u><u>B</u>

       This table prepares flows for possible stateful load balancing process‐
       ing in ingress table <b>L</b><b>B</b> and <b>S</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b>.  It contains  a  priority-0  flow
       that  simply  moves traffic to the next table.  If load balancing rules
       with virtual IP addresses (and ports) are configured in  <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>
       database  for  a  logical switch datapath, a priority-100 flow is added
       for each configured virtual IP address <u>V</u><u>I</u><u>P</u> with a match <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>
       <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u>
        that  sets  an  action  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>]</b>  <b>=</b> <b>1</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> to act as a hint for table
       <b>P</b><b>r</b><b>e</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b> to send IP packets to the connection  tracker  for  packet
       de-fragmentation before eventually advancing to ingress table <b>L</b><b>B</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>5</u><u>:</u> <u>P</u><u>r</u><u>e</u><u>-</u><u>s</u><u>t</u><u>a</u><u>t</u><u>e</u><u>f</u><u>u</u><u>l</u>

       This  table prepares flows for all possible stateful processing in next
       tables.  It contains a priority-0 flow that simply moves traffic to the
       next  table.   A  priority-100  flow  sends  the  packets to connection
       tracker based on a hint provided by the previous tables (with  a  match
       for <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>]</b> <b>=</b><b>=</b> <b>1</b>) by using the <b>c</b><b>t</b><b>_</b><b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> action.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>t</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>6</u><u>:</u> <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> ACLs

       Logical flows in this table closely reproduce those in the <b>A</b><b>C</b><b>L</b> table in
       the <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database for the <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> direction. The  <b>p</b><b>r</b><b>i</b><b>o</b><b>r</b><b>i</b><b>t</b><b>y</b>
       values  from  the <b>A</b><b>C</b><b>L</b> table have a limited range and have 1000 added to
       them to leave room for OVN default flows at both higher and lower  pri‐
       orities.

              ·      <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b>  ACLs  translate  into logical flows with the <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>
                     action.  If there are any stateful ACLs on this datapath,
                     then <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b> ACLs translate to <b>c</b><b>t</b><b>_</b><b>c</b><b>o</b><b>m</b><b>m</b><b>i</b><b>t</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> (which acts
                     as a hint for the next tables to commit the connection to
                     conntrack),

              ·      <b>a</b><b>l</b><b>l</b><b>o</b><b>w</b><b>-</b><b>r</b><b>e</b><b>l</b><b>a</b><b>t</b><b>e</b><b>d</b>  ACLs translate into logical flows with the
                     <b>c</b><b>t</b><b>_</b><b>c</b><b>o</b><b>m</b><b>m</b><b>i</b><b>t</b><b>(</b><b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>=</b><b>0</b><b>/</b><b>1</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> actions  for  new  connec‐
                     tions and <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>]</b> <b>=</b> <b>1</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> for existing connections.

              ·      Other  ACLs  translate to <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b> for new or untracked con‐
                     nections and <b>c</b><b>t</b><b>_</b><b>c</b><b>o</b><b>m</b><b>m</b><b>i</b><b>t</b><b>(</b><b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>=</b><b>1</b><b>/</b><b>1</b><b>)</b><b>;</b> for  known  connec‐
                     tions.   Setting  <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b> marks a connection as one that
                     was previously allowed, but should no longer  be  allowed
                     due to a policy change.

       This  table  also contains a priority 0 flow with action <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>, so that
       ACLs allow packets by default.  If the logical datapath has a statetful
       ACL, the following flows will also be added:

              ·      A priority-1 flow that sets the hint to commit IP traffic
                     to the connection  tracker  (with  action  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>]</b>  <b>=</b>  <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>).   This  is  needed  for  the default allow policy
                     because, while the initiator’s direction may not have any
                     stateful  rules,  the  server’s  may  and then its return
                     traffic would not be known and marked as invalid.

              ·      A priority-65535 flow that  allows  any  traffic  in  the
                     reply  direction for a connection that has been committed
                     to the connection tracker (i.e., established  flows),  as
                     long as the committed flow does not have <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>b</b><b>l</b><b>o</b><b>c</b><b>k</b><b>e</b><b>d</b>
                     set.  We only handle traffic in the reply direction  here
                     because  we  want all packets going in the request direc‐
                     tion to still go through the  flows  that  implement  the
                     currently  defined policy based on ACLs.  If a connection
                     is no longer allowed by policy, <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>b</b><b>l</b><b>o</b><b>c</b><b>k</b><b>e</b><b>d</b> will get
                     set  and packets in the reply direction will no longer be
                     allowed, either.

              ·      A priority-65535 flow that allows  any  traffic  that  is
                     considered  related to a committed flow in the connection
                     tracker (e.g., an ICMP Port Unreachable from  a  non-lis‐
                     tening  UDP port), as long as the committed flow does not
                     have <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>b</b><b>l</b><b>o</b><b>c</b><b>k</b><b>e</b><b>d</b> set.

              ·      A priority-65535 flow that drops all  traffic  marked  by
                     the connection tracker as invalid.

              ·      A  priority-65535 flow that drops all trafic in the reply
                     direction with <b>c</b><b>t</b><b>_</b><b>l</b><b>a</b><b>b</b><b>e</b><b>l</b><b>.</b><b>b</b><b>l</b><b>o</b><b>c</b><b>k</b><b>e</b><b>d</b> set meaning that the con‐
                     nection  should  no  longer  be  allowed  due to a policy
                     change.  Packets in the  request  direction  are  skipped
                     here to let a newly created ACL re-allow this connection.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>7</u><u>:</u> <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> QoS marking

       Logical flows in this table closely reproduce those in the <b>Q</b><b>o</b><b>S</b> table in
       the <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database for the <b>f</b><b>r</b><b>o</b><b>m</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> direction.

              ·      For every qos_rules for every logical switch a flow  will
                     be added at priorities mentioned in the QoS table.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>8</u><u>:</u> <u>L</u><u>B</u>

       It contains a priority-0 flow that simply moves traffic to the next ta‐
       ble.  For established connections a priority 100 flow matches on <b>c</b><b>t</b><b>.</b><b>e</b><b>s</b><b>t</b>
       &amp;&amp;&amp;&amp; <b>!</b><b>c</b><b>t</b><b>.</b><b>r</b><b>e</b><b>l</b> &amp;&amp;&amp;&amp; <b>!</b><b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>!</b><b>c</b><b>t</b><b>.</b><b>i</b><b>n</b><b>v</b> and sets an action <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>2</b><b>]</b> <b>=</b> <b>1</b><b>;</b>  <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>
       to  act as a hint for table <b>S</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b> to send packets through connection
       tracker to NAT the packets.  (The packet will automatically get  DNATed
       to the same IP address as the first packet in that connection.)

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>9</u><u>:</u> <u>S</u><u>t</u><u>a</u><u>t</u><u>e</u><u>f</u><u>u</u><u>l</u>

              ·      For  all the configured load balancing rules for a switch
                     in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database that includes a L4  port  <u>P</u><u>O</u><u>R</u><u>T</u>
                     of  protocol  <u>P</u> and IPv4 address <u>V</u><u>I</u><u>P</u>, a priority-120 flow
                     that matches on <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u>  &amp;&amp;&amp;&amp;  <u>P</u>  &amp;&amp;&amp;&amp;
                     <u>P</u><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>P</u><u>O</u><u>R</u><u>T</u>
                      with an action of <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b>, where <u>a</u><u>r</u><u>g</u><u>s</u> contains comma
                     separated IPv4 addresses (and optional port  numbers)  to
                     load balance to.

              ·      For  all the configured load balancing rules for a switch
                     in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b>  database  that  includes  just  an  IP
                     address <u>V</u><u>I</u><u>P</u> to match on, a priority-110 flow that matches
                     on <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>V</u><u>I</u><u>P</u>  with  an  action  of
                     <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b>,  where  <u>a</u><u>r</u><u>g</u><u>s</u>  contains  comma separated IPv4
                     addresses.

              ·      A priority-100 flow commits packets to connection tracker
                     using <b>c</b><b>t</b><b>_</b><b>c</b><b>o</b><b>m</b><b>m</b><b>i</b><b>t</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> action based on a hint provided by
                     the previous tables (with a match for <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>1</b><b>]</b> <b>=</b><b>=</b> <b>1</b>).

              ·      A priority-100  flow  sends  the  packets  to  connection
                     tracker  using  <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>;</b> as the action based on a hint pro‐
                     vided by the previous tables (with a match for <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>2</b><b>]</b> <b>=</b><b>=</b>
                     <b>1</b>).

              ·      A  priority-0  flow that simply moves traffic to the next
                     table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>0</u><u>:</u> <u>A</u><u>R</u><u>P</u><u>/</u><u>N</u><u>D</u> <u>r</u><u>e</u><u>s</u><u>p</u><u>o</u><u>n</u><u>d</u><u>e</u><u>r</u>

       This table implements ARP/ND responder  for  known  IPs.   It  contains
       these logical flows:

              ·      Priority-100  flows to skip ARP responder if inport is of
                     type <b>l</b><b>o</b><b>c</b><b>a</b><b>l</b><b>n</b><b>e</b><b>t</b>, and advances directly to the next table.

              ·      Priority-50 flows that match ARP requests to  each  known
                     IP  address  <u>A</u>  of every logical router port, and respond
                     with ARP replies  directly  with  corresponding  Ethernet
                     address <u>E</u>:

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>2</b><b>;</b> <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>.</b> <b>*</b><b>/</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>h</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b> <b>=</b> <u>E</u><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b> <u>A</u><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>

                     These  flows  are  omitted  for logical ports (other than
                     router ports) that are down.

              ·      Priority-50 flows that match IPv6 ND  neighbor  solicita‐
                     tions  to each known IP address <u>A</u> (and <u>A</u>’s solicited node
                     address) of every logical router port, and  respond  with
                     neighbor  advertisements directly with corresponding Eth‐
                     ernet address <u>E</u>:

                     <b>n</b><b>d</b><b>_</b><b>n</b><b>a</b> <b>{</b>
                         <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><b>;</b>
                         <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>A</u><b>;</b>
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b> <u>A</u><b>;</b>
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b> <b>=</b> <u>E</u><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                         <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>

                     These flows are omitted for  logical  ports  (other  than
                     router ports) that are down.

              ·      Priority-100  flows  with match criteria like the ARP and
                     ND flows above, except that they only match packets  from
                     the  <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>  that owns the IP addresses in question, with
                     action <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.  These flows prevent OVN from replying  to,
                     for  example,  an ARP request emitted by a VM for its own
                     IP address.  A VM only makes  this  kind  of  request  to
                     attempt  to  detect a duplicate IP address assignment, so
                     sending a reply will prevent the VM from accepting the IP
                     address that it owns.

                     In  place  of  <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>, it would be reasonable to use <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b>
                     for the flows’ actions.  If everything is working  as  it
                     is   configured,   then  this  would  produce  equivalent
                     results, since no host should reply to the request.   But
                     ARPing  for  one’s  own  IP address is intended to detect
                     situations where the network is not  working  as  config‐
                     ured,  so  dropping  the  request  would  frustrate  that
                     intent.

              ·      One priority-0 fallback flow that matches all packets and
                     advances to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>1</u><u>:</u> <u>D</u><u>H</u><u>C</u><u>P</u> <u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u> <u>p</u><u>r</u><u>o</u><u>c</u><u>e</u><u>s</u><u>s</u><u>i</u><u>n</u><u>g</u>

       This  table adds the DHCPv4 options to a DHCPv4 packet from the logical
       ports configured with IPv4 address(es) and DHCPv4  options,  and  simi‐
       larly for DHCPv6 options.

              ·      A  priority-100  logical  flow is added for these logical
                     ports which matches the IPv4 packet with <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> = 68 and
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b>  =  67  and  applies the action <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b> and
                     advances the packet to the next table.

                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b> <b>=</b> <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b><b>(</b><b>o</b><b>f</b><b>f</b><b>e</b><b>r</b><b>_</b><b>i</b><b>p</b> <b>=</b> <u>i</u><u>p</u><b>,</b> <u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u><u>s</u><b>.</b><b>.</b><b>.</b><b>)</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

                     For DHCPDISCOVER and  DHCPREQUEST,  this  transforms  the
                     packet  into  a DHCP reply, adds the DHCP offer IP <u>i</u><u>p</u> and
                     options to the packet, and stores 1  into  reg0[3].   For
                     other  kinds  of  packets, it just stores 0 into reg0[3].
                     Either way, it continues to the next table.

              ·      A priority-100 logical flow is added  for  these  logical
                     ports  which  matches  the IPv6 packet with <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> = 546
                     and <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> = 547 and applies the action  <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>v</b><b>6</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b>
                     and advances the packet to the next table.

                     <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b> <b>=</b> <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>v</b><b>6</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b><b>(</b><b>i</b><b>a</b><b>_</b><b>a</b><b>d</b><b>d</b><b>r</b> <b>=</b> <u>i</u><u>p</u><b>,</b> <u>o</u><u>p</u><u>t</u><u>i</u><u>o</u><u>n</u><u>s</u><b>.</b><b>.</b><b>.</b><b>)</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

                     For  DHCPv6  Solicit/Request/Confirm packets, this trans‐
                     forms the packet into a DHCPv6 Advertise/Reply, adds  the
                     DHCPv6  offer IP <u>i</u><u>p</u> and options to the packet, and stores
                     1 into reg0[3].  For other  kinds  of  packets,  it  just
                     stores  0  into  reg0[3]. Either way, it continues to the
                     next table.

              ·      A priority-0 flow that matches all packets to advances to
                     table 11.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>2</u><u>:</u> <u>D</u><u>H</u><u>C</u><u>P</u> <u>r</u><u>e</u><u>s</u><u>p</u><u>o</u><u>n</u><u>s</u><u>e</u><u>s</u>

       This  table implements DHCP responder for the DHCP replies generated by
       the previous table.

              ·      A priority 100 logical flow  is  added  for  the  logical
                     ports  configured  with DHCPv4 options which matches IPv4
                     packets with <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <b>6</b><b>8</b> &amp;&amp;&amp;&amp; <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>6</b><b>7</b> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b> <b>=</b><b>=</b>
                     <b>1</b>  and  responds  back to the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> after applying these
                     actions.  If <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b> is set  to  1,  it  means  that  the
                     action <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b> was successful.

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><b>;</b>
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>A</u><b>;</b>
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>S</u><b>;</b>
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <b>6</b><b>7</b><b>;</b>
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>6</b><b>8</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>

                     where  <u>E</u>  is  the  server MAC address and <u>S</u> is the server
                     IPv4 address defined in the DHCPv4 options and <u>A</u>  is  the
                     IPv4 address defined in the logical port’s addresses col‐
                     umn.

                     (This terminates ingress packet  processing;  the  packet
                     does not go to the next ingress table.)

              ·      A  priority  100  logical  flow  is added for the logical
                     ports configured with DHCPv6 options which  matches  IPv6
                     packets  with <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <b>5</b><b>4</b><b>6</b> &amp;&amp;&amp;&amp; <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>5</b><b>4</b><b>7</b> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b>
                     <b>=</b><b>=</b> <b>1</b> and responds back to the <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> after applying these
                     actions.   If  <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>3</b><b>]</b>  is  set  to  1, it means that the
                     action <b>p</b><b>u</b><b>t</b><b>_</b><b>d</b><b>h</b><b>c</b><b>p</b><b>v</b><b>6</b><b>_</b><b>o</b><b>p</b><b>t</b><b>s</b> was successful.

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><b>;</b>
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>A</u><b>;</b>
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>S</u><b>;</b>
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <b>5</b><b>4</b><b>7</b><b>;</b>
                     <b>u</b><b>d</b><b>p</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>5</b><b>4</b><b>6</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>

                     where <u>E</u> is the server MAC address and  <u>S</u>  is  the  server
                     IPv6 LLA address  generated from the <b>s</b><b>e</b><b>r</b><b>v</b><b>e</b><b>r</b><b>_</b><b>i</b><b>d</b> defined in
                     the DHCPv6 options and <u>A</u> is the IPv6 address  defined  in
                     the logical port’s addresses column.

                     (This  terminates  packet processing; the packet does not
                     go on the next ingress table.)

              ·      A priority-0 flow that matches all packets to advances to
                     table 12.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>3</u> <u>D</u><u>e</u><u>s</u><u>t</u><u>i</u><u>n</u><u>a</u><u>t</u><u>i</u><u>o</u><u>n</u> <u>L</u><u>o</u><u>o</u><u>k</u><u>u</u><u>p</u>

       This  table  implements  switching behavior.  It contains these logical
       flows:

              ·      A priority-100 flow that outputs all packets with an Eth‐
                     ernet broadcast or multicast <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> to the <b>M</b><b>C</b><b>_</b><b>F</b><b>L</b><b>O</b><b>O</b><b>D</b> mul‐
                     ticast group, which <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> populates with all enabled
                     logical ports.

              ·      One  priority-50  flow  that  matches each known Ethernet
                     address against <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> and outputs  the  packet  to  the
                     single associated output port.

              ·      One priority-0 fallback flow that matches all packets and
                     outputs them to the  <b>M</b><b>C</b><b>_</b><b>U</b><b>N</b><b>K</b><b>N</b><b>O</b><b>W</b><b>N</b>  multicast  group,  which
                     <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b>  populates with all enabled logical ports that
                     accept unknown destination packets.  As a small optimiza‐
                     tion,  if  no  logical  ports  accept unknown destination
                     packets, <b>o</b><b>v</b><b>n</b><b>-</b><b>n</b><b>o</b><b>r</b><b>t</b><b>h</b><b>d</b> omits this multicast group and  logi‐
                     cal flow.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>0</u><u>:</u> <u>P</u><u>r</u><u>e</u><u>-</u><u>L</u><u>B</u>

       This  table  is  similar to ingress table <b>P</b><b>r</b><b>e</b><b>-</b><b>L</b><b>B</b>.  It contains a prior‐
       ity-0 flow that simply moves traffic to the next table.   If  any  load
       balancing  rules  exist  for the datapath, a priority-100 flow is added
       with a match of <b>i</b><b>p</b> and action of <b>r</b><b>e</b><b>g</b><b>0</b><b>[</b><b>0</b><b>]</b> <b>=</b> <b>1</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> to act  as  a  hint
       for table <b>P</b><b>r</b><b>e</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b> to send IP packets to the connection tracker for
       packet de-fragmentation.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>:</u> <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> Pre-ACLs

       This is similar to ingress table <b>P</b><b>r</b><b>e</b><b>-</b><b>A</b><b>C</b><b>L</b><b>s</b> except for <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> traffic.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>:</u> <u>P</u><u>r</u><u>e</u><u>-</u><u>s</u><u>t</u><u>a</u><u>t</u><u>e</u><u>f</u><u>u</u><u>l</u>

       This is similar to ingress table <b>P</b><b>r</b><b>e</b><b>-</b><b>s</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>3</u><u>:</u> <u>L</u><u>B</u>

       This is similar to ingress table <b>L</b><b>B</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>4</u><u>:</u> <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> ACLs

       This is similar to ingress table <b>A</b><b>C</b><b>L</b><b>s</b> except for <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> ACLs.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>5</u><u>:</u> <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b> QoS marking

       This is similar to ingress table <b>Q</b><b>o</b><b>S</b> <b>m</b><b>a</b><b>r</b><b>k</b><b>i</b><b>n</b><b>g</b> except  for  <b>t</b><b>o</b><b>-</b><b>l</b><b>p</b><b>o</b><b>r</b><b>t</b>  qos
       rules.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>6</u><u>:</u> <u>S</u><u>t</u><u>a</u><u>t</u><u>e</u><u>f</u><u>u</u><u>l</u>

       This  is  similar  to  ingress  table <b>S</b><b>t</b><b>a</b><b>t</b><b>e</b><b>f</b><b>u</b><b>l</b> except that there are no
       rules added for load balancing new connections.

       Also a priority 34000 logical flow is added for each logical port which
       has  DHCPv4  options defined to allow the DHCPv4 reply packet and which
       has DHCPv6 options defined to allow the DHCPv6 reply  packet  from  the
       <b>I</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b> <b>T</b><b>a</b><b>b</b><b>l</b><b>e</b> <b>1</b><b>2</b><b>:</b> <b>D</b><b>H</b><b>C</b><b>P</b> <b>r</b><b>e</b><b>s</b><b>p</b><b>o</b><b>n</b><b>s</b><b>e</b><b>s</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>7</u><u>:</u> <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>I</u><u>P</u>

       This  is similar to the port security logic in table <b>I</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b> <b>P</b><b>o</b><b>r</b><b>t</b> <b>S</b><b>e</b><b>c</b><b>u</b><b>‐</b>
       <b>r</b><b>i</b><b>t</b><b>y</b> <b>-</b> <b>I</b><b>P</b> except that <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>, <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>, <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> and <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> are checked
       instead of <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>, <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>, <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> and <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b>

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>8</u><u>:</u> <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>P</u><u>o</u><u>r</u><u>t</u> <u>S</u><u>e</u><u>c</u><u>u</u><u>r</u><u>i</u><u>t</u><u>y</u> <u>-</u> <u>L</u><u>2</u>

       This  is  similar  to  the ingress port security logic in ingress table
       <b>A</b><b>d</b><b>m</b><b>i</b><b>s</b><b>s</b><b>i</b><b>o</b><b>n</b> <b>C</b><b>o</b><b>n</b><b>t</b><b>r</b><b>o</b><b>l</b> <b>a</b><b>n</b><b>d</b> <b>I</b><b>n</b><b>g</b><b>r</b><b>e</b><b>s</b><b>s</b> <b>P</b><b>o</b><b>r</b><b>t</b> <b>S</b><b>e</b><b>c</b><b>u</b><b>r</b><b>i</b><b>t</b><b>y</b> <b>-</b> <b>L</b><b>2</b>,  but  with  important
       differences.   Most  obviously, <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> and <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> are checked instead
       of <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> and <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b>.  Second, packets directed to broadcast or multi‐
       cast  <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>  are always accepted instead of being subject to the port
       security rules; this is implemented through a  priority-100  flow  that
       matches on <b>e</b><b>t</b><b>h</b><b>.</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b> with action <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>.  Finally, to ensure that even
       broadcast and multicast packets are not delivered to  disabled  logical
       ports,  a priority-150 flow for each disabled logical <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> overrides
       the priority-100 flow with a <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b> action.

   <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b> <b>R</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b> <b>D</b><b>a</b><b>t</b><b>a</b><b>p</b><b>a</b><b>t</b><b>h</b><b>s</b>
       Logical router datapaths will only exist for <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>R</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b> rows in the
       <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database that do not have <b>e</b><b>n</b><b>a</b><b>b</b><b>l</b><b>e</b><b>d</b> set to <b>f</b><b>a</b><b>l</b><b>s</b><b>e</b>

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>0</u><u>:</u> <u>L</u><u>2</u> <u>A</u><u>d</u><u>m</u><u>i</u><u>s</u><u>s</u><u>i</u><u>o</u><u>n</u> <u>C</u><u>o</u><u>n</u><u>t</u><u>r</u><u>o</u><u>l</u>

       This  table drops packets that the router shouldn’t see at all based on
       their Ethernet headers.  It contains the following flows:

              ·      Priority-100 flows to drop packets with VLAN tags or mul‐
                     ticast Ethernet source addresses.

              ·      For each enabled router port <u>P</u> with Ethernet address <u>E</u>, a
                     priority-50 flow that matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u>  &amp;&amp;&amp;&amp;  <b>(</b><b>e</b><b>t</b><b>h</b><b>.</b><b>m</b><b>c</b><b>a</b><b>s</b><b>t</b>
                     <b>|</b><b>|</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>E</u>), with action <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

       Other packets are implicitly dropped.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>:</u> <u>I</u><u>P</u> <u>I</u><u>n</u><u>p</u><u>u</u><u>t</u>

       This  table  is  the core of the logical router datapath functionality.
       It contains the following flows to implement very basic IP  host  func‐
       tionality.

              ·      L3  admission  control: A priority-100 flow drops packets
                     that match any of the following:

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b><b>[</b><b>2</b><b>8</b><b>.</b><b>.</b><b>3</b><b>1</b><b>]</b> <b>=</b><b>=</b> <b>0</b><b>x</b><b>e</b> (multicast source)

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <b>2</b><b>5</b><b>5</b><b>.</b><b>2</b><b>5</b><b>5</b><b>.</b><b>2</b><b>5</b><b>5</b><b>.</b><b>2</b><b>5</b><b>5</b> (broadcast source)

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <b>1</b><b>2</b><b>7</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>/</b><b>8</b> <b>|</b><b>|</b> <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <b>1</b><b>2</b><b>7</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>/</b><b>8</b>
                            (localhost source or destination)

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b><b>=</b> <b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>/</b><b>8</b> <b>|</b><b>|</b> <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>.</b><b>0</b><b>/</b><b>8</b> (zero
                            network source or destination)

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> or <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> is any IP address owned by  the
                            router.

                     ·      <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> is the broadcast address of any IP network
                            known to the router.

              ·      ICMP echo reply.  These flows reply to ICMP echo requests
                     received  for  the  router’s  IP address.  Let <u>A</u> be an IP
                     address owned by a router port.  Then, for each <u>A</u> that is
                     an IPv4 address, a priority-90 flow matches on <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b>
                     <u>A</u> and <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b><b>=</b> <b>8</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>c</b><b>o</b><b>d</b><b>e</b>  <b>=</b><b>=</b>  <b>0</b>  (ICMP  echo
                     request).   For  each <u>A</u> that is an IPv6 address, a prior‐
                     ity-90 flow matches on <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>A</u> and <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b><b>=</b> <b>1</b><b>2</b><b>8</b>
                     &amp;&amp;&amp;&amp;  <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>c</b><b>o</b><b>d</b><b>e</b>  <b>=</b><b>=</b>  <b>0</b> (ICMPv6 echo request).  The port of
                     the router that receives the echo request does  not  mat‐
                     ter.  Also,  the <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> of the echo request packet is not
                     checked, so it complies with RFC 1812,  section  4.2.2.9.
                     Flows for ICMPv4 echo requests use the following actions:

                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <lt;<lt;<b>-</b>>gt;>gt; <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b> <b>2</b><b>5</b><b>5</b><b>;</b>
                     <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b> <b>0</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

                     Flows for ICMPv6 echo requests use the following actions:

                     <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b> <lt;<lt;<b>-</b>>gt;>gt; <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b> <b>2</b><b>5</b><b>5</b><b>;</b>
                     <b>i</b><b>c</b><b>m</b><b>p</b><b>6</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b> <b>1</b><b>2</b><b>9</b><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

              <b>·</b>      Reply to ARP requests.

                     These flows reply to ARP requests for the router’s own IP
                     address.  For each router port <u>P</u> that owns IP  address  <u>A</u>
                     and Ethernet address <u>E</u>, a priority-90 flow matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>
                     <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>A</u>  (ARP  request)  with
                     the following actions:

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>2</b><b>;</b> <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>.</b> <b>*</b><b>/</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>h</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b> <b>=</b> <u>E</u><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b> <u>A</u><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>

              <b>·</b>      These  flows  reply  to  ARP  requests for the virtual IP
                     addresses configured in the router for DNAT or load  bal‐
                     ancing.   For a configured DNAT IP address or a load bal‐
                     ancer VIP <u>A</u>, for each router port <u>P</u> with Ethernet address
                     <u>E</u>,  a priority-90 flow matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b><b>=</b> <b>1</b>
                     &amp;&amp;&amp;&amp; <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b><b>=</b> <u>A</u> (ARP request) with the following actions:

                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>2</b><b>;</b> <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>p</b><b>l</b><b>y</b><b>.</b> <b>*</b><b>/</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>h</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b> <b>=</b> <u>E</u><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>;</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b> <u>A</u><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>

              <b>·</b>      ARP reply handling.  This flow uses ARP replies to  popu‐
                     late  the logical router’s ARP table.  A priority-90 flow
                     with  match  <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b>  <b>=</b><b>=</b>  <b>2</b>  has  actions  <b>p</b><b>u</b><b>t</b><b>_</b><b>a</b><b>r</b><b>p</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b>
                     <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b><b>,</b> <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>h</b><b>a</b><b>)</b><b>;</b>.

              ·      Reply  to IPv6 Neighbor Solicitations.  These flows reply
                     to Neighbor Solicitation requests for  the  router’s  own
                     IPv6  address and populate the logical router’s mac bind‐
                     ing table.  For each router port <u>P</u> that owns IPv6 address
                     <u>A</u>,  solicited  node  address <u>S</u>, and Ethernet address <u>E</u>, a
                     priority-90 flow matches <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>n</b><b>d</b><b>_</b><b>n</b><b>s</b> &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>
                     <b>=</b><b>=</b> <b>{</b><u>A</u><b>,</b> <u>E</u><b>}</b> &amp;&amp;&amp;&amp; <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b><b>=</b> <u>A</u> with the following actions:

                     <b>p</b><b>u</b><b>t</b><b>_</b><b>n</b><b>d</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>s</b><b>l</b><b>l</b><b>)</b><b>;</b>
                     <b>n</b><b>d</b><b>_</b><b>n</b><b>a</b> <b>{</b>
                         <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><b>;</b>
                         <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>A</u><b>;</b>
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b> <b>=</b> <u>A</u><b>;</b>
                         <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b> <b>=</b> <u>E</u><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>;</b>
                         <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>

              <b>·</b>      IPv6  neighbor  advertisement  handling.   This flow uses
                     neighbor advertisements to populate the logical  router’s
                     mac  binding  table.  A priority-90 flow with match <b>n</b><b>d</b><b>_</b><b>n</b><b>a</b>
                     has actions <b>p</b><b>u</b><b>t</b><b>_</b><b>n</b><b>d</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>t</b><b>a</b><b>r</b><b>g</b><b>e</b><b>t</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>t</b><b>l</b><b>l</b><b>)</b><b>;</b>.

              ·      IPv6 neighbor solicitation for non-hosted addresses  han‐
                     dling.  This flow uses neighbor solicitations to populate
                     the logical router’s mac binding table  (ones  that  were
                     directed  at  the  logical  router would have matched the
                     priority-90 neighbor solicitation flow already).  A  pri‐
                     ority-80 flow with match <b>n</b><b>d</b><b>_</b><b>n</b><b>s</b> has actions <b>p</b><b>u</b><b>t</b><b>_</b><b>n</b><b>d</b><b>(</b><b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b>
                     <b>i</b><b>p</b><b>6</b><b>.</b><b>s</b><b>r</b><b>c</b><b>,</b> <b>n</b><b>d</b><b>.</b><b>s</b><b>l</b><b>l</b><b>)</b><b>;</b>.

              ·      UDP port unreachable.  Priority-80  flows  generate  ICMP
                     port  unreachable  messages  in  reply  to  UDP datagrams
                     directed to the router’s IP address.  The logical  router
                     doesn’t  accept  any  UDP  traffic so it always generates
                     such a reply.

                     These flows should not match IP  fragments  with  nonzero
                     offset.

                     Details TBD.  Not yet implemented.

              ·      TCP reset.  Priority-80 flows generate TCP reset messages
                     in reply to TCP datagrams directed  to  the  router’s  IP
                     address.  The logical router doesn’t accept any TCP traf‐
                     fic so it always generates such a reply.

                     These flows should not match IP  fragments  with  nonzero
                     offset.

                     Details TBD.  Not yet implemented.

              ·      Protocol  unreachable.   Priority-70  flows generate ICMP
                     protocol  unreachable  messages  in  reply   to   packets
                     directed to the router’s IP address on IP protocols other
                     than UDP, TCP, and ICMP.

                     These flows should not match IP  fragments  with  nonzero
                     offset.

                     Details TBD.  Not yet implemented.

              ·      Drop  other  IP traffic to this router.  These flows drop
                     any other traffic destined  to  an  IP  address  of  this
                     router  that  is  not already handled by one of the flows
                     above, which amounts to ICMP (other than  echo  requests)
                     and  fragments with nonzero offsets.  For each IP address
                     <u>A</u> owned by the router, a priority-60 flow matches <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>
                     <b>=</b><b>=</b> <u>A</u> and drops the traffic.  An exception is made and the
                     above flow is not added  if  the  router  port’s  own  IP
                     address  is  used  to  SNAT  packets passing through that
                     router.

       The flows above handle all of the traffic that might be directed to the
       router  itself.  The following flows (with lower priorities) handle the
       remaining traffic, potentially for forwarding:

              ·      Drop Ethernet local broadcast.  A priority-50  flow  with
                     match  <b>e</b><b>t</b><b>h</b><b>.</b><b>b</b><b>c</b><b>a</b><b>s</b><b>t</b> drops traffic destined to the local Eth‐
                     ernet broadcast  address.   By  definition  this  traffic
                     should not be forwarded.

              ·      ICMP  time  exceeded.   For  each router port <u>P</u>, whose IP
                     address is <u>A</u>, a priority-40 flow with match <b>i</b><b>n</b><b>p</b><b>o</b><b>r</b><b>t</b>  <b>=</b><b>=</b>  <u>P</u>
                     &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b>  <b>=</b><b>=</b>  <b>{</b><b>0</b><b>,</b>  <b>1</b><b>}</b> &amp;&amp;&amp;&amp; <b>!</b><b>i</b><b>p</b><b>.</b><b>l</b><b>a</b><b>t</b><b>e</b><b>r</b><b>_</b><b>f</b><b>r</b><b>a</b><b>g</b> matches packets
                     whose TTL has expired, with the following actions to send
                     an ICMP time exceeded reply:

                     <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b> <b>{</b>
                         <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>t</b><b>y</b><b>p</b><b>e</b> <b>=</b> <b>1</b><b>1</b><b>;</b> <b>/</b><b>*</b> <b>T</b><b>i</b><b>m</b><b>e</b> <b>e</b><b>x</b><b>c</b><b>e</b><b>e</b><b>d</b><b>e</b><b>d</b><b>.</b> <b>*</b><b>/</b>
                         <b>i</b><b>c</b><b>m</b><b>p</b><b>4</b><b>.</b><b>c</b><b>o</b><b>d</b><b>e</b> <b>=</b> <b>0</b><b>;</b>  <b>/</b><b>*</b> <b>T</b><b>T</b><b>L</b> <b>e</b><b>x</b><b>c</b><b>e</b><b>e</b><b>d</b><b>e</b><b>d</b> <b>i</b><b>n</b> <b>t</b><b>r</b><b>a</b><b>n</b><b>s</b><b>i</b><b>t</b><b>.</b> <b>*</b><b>/</b>
                         <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b><b>;</b>
                         <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>A</u><b>;</b>
                         <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b> <b>2</b><b>5</b><b>5</b><b>;</b>
                         <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>

                     Not yet implemented.

              ·      TTL discard.  A priority-30 flow with match <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b> <b>=</b><b>=</b> <b>{</b><b>0</b><b>,</b>
                     <b>1</b><b>}</b> and actions <b>d</b><b>r</b><b>o</b><b>p</b><b>;</b> drops other packets  whose  TTL  has
                     expired, that should not receive a ICMP error reply (i.e.
                     fragments with nonzero offset).

              ·      Next table.  A priority-0 flows match  all  packets  that
                     aren’t  already  handled  and  uses actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> to feed
                     them to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>2</u><u>:</u> <u>D</u><u>E</u><u>F</u><u>R</u><u>A</u><u>G</u>

       This is to send packets to connection tracker for tracking and  defrag‐
       mentation.   It contains a priority-0 flow that simply moves traffic to
       the next table.  If load balancing rules with virtual IP addresses (and
       ports)  are configured in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database for a Gateway router,
       a priority-100 flow is added for each configured virtual IP address <u>V</u><u>I</u><u>P</u>
       with  a match <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> that sets an action <b>c</b><b>t</b><b>_</b><b>n</b><b>e</b><b>x</b><b>t</b><b>;</b> to send
       IP packets to the connection tracker for  packet  de-fragmentation  and
       tracking before sending it to the next table.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>3</u><u>:</u> <u>U</u><u>N</u><u>S</u><u>N</u><u>A</u><u>T</u>

       This  is  for  already established connections’ reverse traffic.  i.e.,
       SNAT has already been done in egress pipeline and now  the  packet  has
       entered the ingress pipeline as part of a reply.  It is unSNATted here.

              ·      For  each  configuration  in the OVN Northbound database,
                     that asks to change the source IP  address  of  a  packet
                     from <u>A</u> to <u>B</u>, a priority-100 flow matches <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b>
                     <u>B</u> with an action <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>4</u><u>:</u> <u>D</u><u>N</u><u>A</u><u>T</u>

       Packets enter the pipeline with destination IP address that needs to be
       DNATted from a virtual IP address to a real IP address.  Packets in the
       reverse direction needs to be unDNATed.

              ·      For all the configured load balancing rules  for  Gateway
                     router in <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database that includes a L4 port
                     <u>P</u><u>O</u><u>R</u><u>T</u> of protocol <u>P</u> and IPv4 address <u>V</u><u>I</u><u>P</u>,  a  priority-120
                     flow  that matches on <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> &amp;&amp;&amp;&amp; <u>P</u>
                     &amp;&amp;&amp;&amp; <u>P</u><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>P</u><u>O</u><u>R</u><u>T</u>
                      with an action of <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b>, where <u>a</u><u>r</u><u>g</u><u>s</u> contains comma
                     separated  IPv4  addresses (and optional port numbers) to
                     load balance to.

              ·      For all the configured load balancing rules  for  Gateway
                     router  in  <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database that includes just an
                     IP address <u>V</u><u>I</u><u>P</u> to match  on,  a  priority-110  flow  that
                     matches  on <b>c</b><b>t</b><b>.</b><b>n</b><b>e</b><b>w</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b> &amp;&amp;&amp;&amp; <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <u>V</u><u>I</u><u>P</u> with an action
                     of <b>c</b><b>t</b><b>_</b><b>l</b><b>b</b><b>(</b><u>a</u><u>r</u><u>g</u><u>s</u><b>)</b>, where <u>a</u><u>r</u><u>g</u><u>s</u> contains comma separated  IPv4
                     addresses.

              ·      For  each  configuration  in the OVN Northbound database,
                     that asks to change  the  destination  IP  address  of  a
                     packet  from  <u>A</u>  to  <u>B</u>, a priority-100 flow matches <b>i</b><b>p</b> &amp;&amp;&amp;&amp;
                     <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>A</u>  with  an  action  <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b>   <b>=</b>   <b>1</b><b>;</b>
                     <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>(</b><u>B</u><b>)</b><b>;</b>.

              ·      For  all  IP  packets  of a Gateway router, a priority-50
                     flow with an action <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b> <b>c</b><b>t</b><b>_</b><b>d</b><b>n</b><b>a</b><b>t</b><b>;</b>.

              ·      A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>5</u><u>:</u> <u>I</u><u>P</u> <u>R</u><u>o</u><u>u</u><u>t</u><u>i</u><u>n</u><u>g</u>

       A packet that arrives at this table is an  IP  packet  that  should  be
       routed  to the address in <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>.  This table implements IP
       routing, setting <b>r</b><b>e</b><b>g</b><b>0</b> (or <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b> for IPv6) to the next-hop  IP  address
       (leaving <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>, the packet’s final destination, unchanged)
       and advances to the next table for ARP resolution.  It also  sets  <b>r</b><b>e</b><b>g</b><b>1</b>
       (or  <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>1</b>) to the IP address owned by the selected router port (Table
       7 will generate ARP request, if needed, with <b>r</b><b>e</b><b>g</b><b>0</b> as the target  proto‐
       col address and <b>r</b><b>e</b><b>g</b><b>1</b> as the source protocol address).

       This table contains the following logical flows:

              ·      IPv4  routing  table.   For  each route to IPv4 network <u>N</u>
                     with netmask <u>M</u>, on router port <u>P</u> with IP  address  <u>A</u>  and
                     Ethernet  address <u>E</u>, a logical flow with match <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b>
                     <u>N</u><b>/</b><u>M</u>, whose priority is the number of 1-bits in <u>M</u>, has the
                     following actions:

                     <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b><b>-</b><b>-</b><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b> <u>G</u><b>;</b>
                     <b>r</b><b>e</b><b>g</b><b>1</b> <b>=</b> <u>A</u><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

                     (Ingress table 1 already verified that <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b><b>-</b><b>-</b><b>;</b> will not
                     yield a TTL exceeded error.)

                     If the route has a gateway, <u>G</u> is the gateway IP  address.
                     Instead,  if the route is from a configured static route,
                     <u>G</u> is the next hop IP address.  Else it is <b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b>.

              ·      IPv6 routing table.  For each route  to  IPv6  network  <u>N</u>
                     with  netmask  <u>M</u>,  on router port <u>P</u> with IP address <u>A</u> and
                     Ethernet address <u>E</u>, a logical flow  with  match  in  CIDR
                     notation  <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>  <b>=</b><b>=</b>  <u>N</u><b>/</b><u>M</u>, whose priority is the integer
                     value of <u>M</u>, has the following actions:

                     <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b><b>-</b><b>-</b><b>;</b>
                     <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b> <u>G</u><b>;</b>
                     <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>1</b> <b>=</b> <u>A</u><b>;</b>
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>s</b><b>r</b><b>c</b> <b>=</b> <u>E</u><b>;</b>
                     <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b> <u>P</u><b>;</b>
                     <b>f</b><b>l</b><b>a</b><b>g</b><b>s</b><b>.</b><b>l</b><b>o</b><b>o</b><b>p</b><b>b</b><b>a</b><b>c</b><b>k</b> <b>=</b> <b>1</b><b>;</b>
                     <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>

                     (Ingress table 1 already verified that <b>i</b><b>p</b><b>.</b><b>t</b><b>t</b><b>l</b><b>-</b><b>-</b><b>;</b> will not
                     yield a TTL exceeded error.)

                     If  the route has a gateway, <u>G</u> is the gateway IP address.
                     Instead, if the route is from a configured static  route,
                     <u>G</u> is the next hop IP address.  Else it is <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>.

                     If  the  address  <u>A</u> is in the link-local scope, the route
                     will be limited to sending on the ingress port.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>6</u><u>:</u> <u>A</u><u>R</u><u>P</u><u>/</u><u>N</u><u>D</u> <u>R</u><u>e</u><u>s</u><u>o</u><u>l</u><u>u</u><u>t</u><u>i</u><u>o</u><u>n</u>

       Any packet that reaches this table is an IP packet whose next-hop  IPv4
       address  is  in <b>r</b><b>e</b><b>g</b><b>0</b> or IPv6 address is in <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b>.  (<b>i</b><b>p</b><b>4</b><b>.</b><b>d</b><b>s</b><b>t</b> or <b>i</b><b>p</b><b>6</b><b>.</b><b>d</b><b>s</b><b>t</b>
       contains the final destination.)  This table resolves the IP address in
       <b>r</b><b>e</b><b>g</b><b>0</b> (or <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b>) into an output port in <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> and an Ethernet address
       in <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>, using the following flows:

              ·      Static MAC bindings.  MAC bindings can  be  known  stati‐
                     cally  based on data in the <b>O</b><b>V</b><b>N</b><b>_</b><b>N</b><b>o</b><b>r</b><b>t</b><b>h</b><b>b</b><b>o</b><b>u</b><b>n</b><b>d</b> database.  For
                     router ports connected to logical switches, MAC  bindings
                     can  be known statically from the <b>a</b><b>d</b><b>d</b><b>r</b><b>e</b><b>s</b><b>s</b><b>e</b><b>s</b> column in the
                     <b>L</b><b>o</b><b>g</b><b>i</b><b>c</b><b>a</b><b>l</b><b>_</b><b>S</b><b>w</b><b>i</b><b>t</b><b>c</b><b>h</b><b>_</b><b>P</b><b>o</b><b>r</b><b>t</b> table.  For router ports connected to
                     other  logical  routers, MAC bindings can be known stati‐
                     cally from the <b>m</b><b>a</b><b>c</b>  and  <b>n</b><b>e</b><b>t</b><b>w</b><b>o</b><b>r</b><b>k</b><b>s</b>  column  in  the  <b>L</b><b>o</b><b>g</b><b>i</b><b>‐</b>
                     <b>c</b><b>a</b><b>l</b><b>_</b><b>R</b><b>o</b><b>u</b><b>t</b><b>e</b><b>r</b><b>_</b><b>P</b><b>o</b><b>r</b><b>t</b> table.

                     For  each IPv4 address <u>A</u> whose host is known to have Eth‐
                     ernet address <u>E</u> on router port  <u>P</u>,  a  priority-100  flow
                     with match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b> <u>A</u> has actions <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b>
                     <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     For each IPv6 address <u>A</u> whose host is known to have  Eth‐
                     ernet  address  <u>E</u>  on  router port <u>P</u>, a priority-100 flow
                     with match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> <b>=</b><b>=</b><b>=</b> <u>P</u>  &amp;&amp;&amp;&amp;  <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b>  <b>=</b><b>=</b>  <u>A</u>  has  actions
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     For each logical router port with an IPv4 address <u>A</u> and a
                     mac address of <u>E</u> that is reachable via a different  logi‐
                     cal router port <u>P</u>, a priority-100 flow with match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>
                     <b>=</b><b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b> <u>A</u> has actions <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     For each logical router port with an IPv6 address <u>A</u> and a
                     mac  address of <u>E</u> that is reachable via a different logi‐
                     cal router port <u>P</u>, a priority-100 flow with match <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b>
                     <b>=</b><b>=</b><b>=</b> <u>P</u> &amp;&amp;&amp;&amp; <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b> <b>=</b><b>=</b> <u>A</u> has actions <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <u>E</u><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

              ·      Dynamic  MAC  bindings.   These  flows  resolve MAC-to-IP
                     bindings that have become known dynamically  through  ARP
                     or neighbor discovery.  (The next table will issue an ARP
                     or neighbor solicitation  request  for  cases  where  the
                     binding is not yet known.)

                     A  priority-0  logical  flow  with  match <b>i</b><b>p</b><b>4</b> has actions
                     <b>g</b><b>e</b><b>t</b><b>_</b><b>a</b><b>r</b><b>p</b><b>(</b><b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>r</b><b>e</b><b>g</b><b>0</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

                     A priority-0 logical flow  with  match  <b>i</b><b>p</b><b>6</b>  has  actions
                     <b>g</b><b>e</b><b>t</b><b>_</b><b>n</b><b>d</b><b>(</b><b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b><b>,</b> <b>x</b><b>x</b><b>r</b><b>e</b><b>g</b><b>0</b><b>)</b><b>;</b> <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>I</u><u>n</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>7</u><u>:</u> <u>A</u><u>R</u><u>P</u> <u>R</u><u>e</u><u>q</u><u>u</u><u>e</u><u>s</u><u>t</u>

       In  the  common  case where the Ethernet destination has been resolved,
       this table outputs the packet.  Otherwise, it composes and sends an ARP
       request.  It holds the following flows:

              ·      Unknown  MAC  address.   A  priority-100  flow with match
                     <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b><b>=</b> <b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b><b>:</b><b>0</b><b>0</b> has the following actions:

                     <b>a</b><b>r</b><b>p</b> <b>{</b>
                         <b>e</b><b>t</b><b>h</b><b>.</b><b>d</b><b>s</b><b>t</b> <b>=</b> <b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>:</b><b>f</b><b>f</b><b>;</b>
                         <b>a</b><b>r</b><b>p</b><b>.</b><b>s</b><b>p</b><b>a</b> <b>=</b> <b>r</b><b>e</b><b>g</b><b>1</b><b>;</b>
                         <b>a</b><b>r</b><b>p</b><b>.</b><b>t</b><b>p</b><b>a</b> <b>=</b> <b>r</b><b>e</b><b>g</b><b>0</b><b>;</b>
                         <b>a</b><b>r</b><b>p</b><b>.</b><b>o</b><b>p</b> <b>=</b> <b>1</b><b>;</b>  <b>/</b><b>*</b> <b>A</b><b>R</b><b>P</b> <b>r</b><b>e</b><b>q</b><b>u</b><b>e</b><b>s</b><b>t</b><b>.</b> <b>*</b><b>/</b>
                         <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>
                     <b>}</b><b>;</b>

                     (Ingress table 4 initialized <b>r</b><b>e</b><b>g</b><b>1</b>  with  the  IP  address
                     owned by <b>o</b><b>u</b><b>t</b><b>p</b><b>o</b><b>r</b><b>t</b> and <b>r</b><b>e</b><b>g</b><b>0</b> with the next-hop IP address)

                     The IP packet that triggers the ARP request is dropped.

              ·      Known  MAC  address.   A priority-0 flow with match <b>1</b> has
                     actions <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>0</u><u>:</u> <u>S</u><u>N</u><u>A</u><u>T</u>

       Packets that are configured to be SNATed get their  source  IP  address
       changed based on the configuration in the OVN Northbound database.

              ·      For  each  configuration  in the OVN Northbound database,
                     that asks to change the source IP  address  of  a  packet
                     from  an  IP  address  of  <u>A</u>  or  to change the source IP
                     address of a packet that belongs to network  <u>A</u>  to  <u>B</u>,  a
                     flow   matches   <b>i</b><b>p</b>  &amp;&amp;&amp;&amp;  <b>i</b><b>p</b><b>4</b><b>.</b><b>s</b><b>r</b><b>c</b>  <b>=</b><b>=</b>  <u>A</u>  with  an  action
                     <b>c</b><b>t</b><b>_</b><b>s</b><b>n</b><b>a</b><b>t</b><b>(</b><u>B</u><b>)</b><b>;</b>.  The priority  of  the  flow  is  calculated
                     based  on the mask of <u>A</u>, with matches having larger masks
                     getting higher priorities.

                     A priority-0 logical flow with match <b>1</b> has actions <b>n</b><b>e</b><b>x</b><b>t</b><b>;</b>.

     <u>E</u><u>g</u><u>r</u><u>e</u><u>s</u><u>s</u> <u>T</u><u>a</u><u>b</u><u>l</u><u>e</u> <u>1</u><u>:</u> <u>D</u><u>e</u><u>l</u><u>i</u><u>v</u><u>e</u><u>r</u><u>y</u>

       Packets that reach this table are ready for delivery.  It contains pri‐
       ority-100  logical  flows  that  match  packets on each enabled logical
       router port, with action <b>o</b><b>u</b><b>t</b><b>p</b><b>u</b><b>t</b><b>;</b>.



Open vSwitch 2.6.90               ovn-northd                     ovn-northd(8)
</pre></body></html>
